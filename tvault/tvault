#!/bin/bash
#
# tvault (Text Vault) wrapper script
# Version: 1.1

# Default installation path
TVAULT_PY="${HOME}/.local/lib/tvault/tvault.py"

# Check if tvault is installed
if [ ! -f "$TVAULT_PY" ]; then
    echo "Error: tvault is not installed or not found at $TVAULT_PY"
    echo "Please install with: pip3 install textvault"
    exit 1
fi

# Show help if no arguments
if [ $# -eq 0 ]; then
    echo "Text Vault (tvault) - A lightweight text file management system"
    echo "Usage: tvault <operation> [filename] [options]"
    echo ""
    echo "Operations:"
    echo "  new <file>      Create a new text file"
    echo "  read <file>     Read content from a file"
    echo "  write <file>    Write content to a file (with backup)"
    echo "  backup <file>   Create a backup of a file"
    echo "  recover <file>  Recover file from backup"
    echo "  remove <file>   Remove a file"
    echo "  removebak <file> Remove backup file"
    echo "  readbak <file>  Read content from backup"
    echo "  list            List all files in database"
    echo "  dumpdb          Backup entire database"
    echo "  rmdb            Remove database and uninstall"
    echo ""
    echo "Options:"
    echo "  --force         Force overwrite when creating files"
    echo "  --data-dir DIR  Use custom data directory"
    echo ""
    echo "Examples:"
    echo "  tvault new notes"
    echo "  tvault write notes"
    echo "  tvault read notes"
    echo "  tvault list"
    exit 0
fi

# Parse arguments
OPERATION="$1"
shift

# Handle operations without filename
case "$OPERATION" in
    list|dumpdb|rmdb)
        python3 "$TVAULT_PY" "$OPERATION" "$@"
        ;;
    *)
        # Operations that require filename
        if [ $# -eq 0 ]; then
            echo "Error: Operation '$OPERATION' requires a filename!"
            echo "Usage: tvault $OPERATION <filename>"
            exit 1
        fi
        FILENAME="$1"
        shift
        python3 "$TVAULT_PY" "$OPERATION" "$FILENAME" "$@"
        ;;
esac
